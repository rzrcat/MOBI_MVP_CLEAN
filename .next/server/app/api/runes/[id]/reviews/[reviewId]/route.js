"use strict";(()=>{var e={};e.id=980,e.ids=[980],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},82271:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>x,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{DELETE:()=>p,PUT:()=>l});var i=t(49303),n=t(88716),o=t(60670),a=t(20344),u=t(71615),d=t(87070);async function l(e,{params:r}){let t=(0,a.createRouteHandlerClient)({cookies:u.cookies}),{reviewId:s}=r,{data:i}=await t.auth.getSession();if(!i?.session?.user)return d.NextResponse.json({error:"Authentication required"},{status:401});try{let{content:r}=await e.json(),n=i.session.user.id;if(!r||0===r.trim().length)return d.NextResponse.json({error:"한줄평 내용이 필요합니다."},{status:400});if(r.length>100)return d.NextResponse.json({error:"한줄평은 100자 이내여야 합니다."},{status:400});let{data:o}=await t.from("rune_reviews").select("user_id").eq("id",s).single();if(!o)return d.NextResponse.json({error:"한줄평을 찾을 수 없습니다."},{status:404});let{data:a}=await t.from("admin_roles").select("*").eq("user_id",n),u=a&&a.length>0;if(o.user_id!==n&&!u)return d.NextResponse.json({error:"이 한줄평을 수정할 권한이 없습니다."},{status:403});let{data:l,error:p}=await t.from("rune_reviews").update({content:r}).eq("id",s).select(`
        id, 
        content, 
        created_at,
        likes,
        dislikes,
        is_blinded,
        users:user_id (
          id,
          full_name,
          avatar_url
        )
      `).single();if(p)return console.error("Error updating rune review:",p),d.NextResponse.json({error:p.message},{status:500});let{data:c}=await t.from("rune_review_reactions").select("reaction_type").eq("review_id",s).eq("user_id",n).maybeSingle(),x=l.users;return d.NextResponse.json({id:l.id,content:l.content,author:Array.isArray(x)?{id:x[0]?.id,name:x[0]?.full_name||"익명 사용자",avatar:x[0]?.avatar_url}:{id:x?.id,name:x?.full_name||"익명 사용자",avatar:x?.avatar_url},createdAt:l.created_at,likes:l.likes||0,dislikes:l.dislikes||0,isLiked:c?.reaction_type==="like",isDisliked:c?.reaction_type==="dislike",isBlinded:l.is_blinded})}catch(e){return console.error("Unexpected error in rune review PUT:",e),d.NextResponse.json({error:"Server error occurred"},{status:500})}}async function p(e,{params:r}){let t=(0,a.createRouteHandlerClient)({cookies:u.cookies}),{reviewId:s}=r,{data:i}=await t.auth.getSession();if(!i?.session?.user)return d.NextResponse.json({error:"Authentication required"},{status:401});try{let e=i.session.user.id,{data:r}=await t.from("rune_reviews").select("user_id").eq("id",s).single();if(!r)return d.NextResponse.json({error:"한줄평을 찾을 수 없습니다."},{status:404});let{data:n}=await t.from("admin_roles").select("*").eq("user_id",e),o=n&&n.length>0;if(r.user_id!==e&&!o)return d.NextResponse.json({error:"이 한줄평을 삭제할 권한이 없습니다."},{status:403});let{error:a}=await t.from("rune_reviews").delete().eq("id",s);if(a)return console.error("Error deleting rune review:",a),d.NextResponse.json({error:a.message},{status:500});return d.NextResponse.json({success:!0})}catch(e){return console.error("Unexpected error in rune review DELETE:",e),d.NextResponse.json({error:"Server error occurred"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/runes/[id]/reviews/[reviewId]/route",pathname:"/api/runes/[id]/reviews/[reviewId]",filename:"route",bundlePath:"app/api/runes/[id]/reviews/[reviewId]/route"},resolvedPagePath:"/Users/s/Desktop/dev/mobi.gg/src/app/api/runes/[id]/reviews/[reviewId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:v,serverHooks:m}=c,w="/api/runes/[id]/reviews/[reviewId]/route";function _(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:v})}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,518,958],()=>t(82271));module.exports=s})();