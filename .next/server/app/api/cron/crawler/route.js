(()=>{var e={};e.id=370,e.ids=[370],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},98061:e=>{"use strict";e.exports=require("node:assert")},92761:e=>{"use strict";e.exports=require("node:async_hooks")},72254:e=>{"use strict";e.exports=require("node:buffer")},40027:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},30604:e=>{"use strict";e.exports=require("node:dns")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},42725:e=>{"use strict";e.exports=require("node:http2")},87503:e=>{"use strict";e.exports=require("node:net")},38846:e=>{"use strict";e.exports=require("node:perf_hooks")},39630:e=>{"use strict";e.exports=require("node:querystring")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},93746:e=>{"use strict";e.exports=require("node:util/types")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},87529:()=>{},52488:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var s={};t.r(s),t.d(s,{GET:()=>u});var o=t(49303),i=t(88716),n=t(60670),a=t(87070),c=t(30626);async function u(e){let{searchParams:r}=new URL(e.url),t=r.get("token"),s=process.env.CRAWLER_SECRET_TOKEN;if(s&&t!==s)return(0,c.cM)(c.in.ERROR,"크롤러 API 인증 실패",{ip:e.headers.get("x-forwarded-for")}),a.NextResponse.json({error:"인증 실패"},{status:401});let o=Date.now();(0,c.cM)(c.in.INFO,"통합 크롤러 API 시작",{timestamp:new Date().toISOString()});try{let r=await Promise.allSettled([fetch(new URL("/api/cron/crawler/mabinogi_mobile",e.url).toString(),{method:"GET",headers:s?{Authorization:`Bearer ${s}`}:void 0}).then(e=>e.json())]),t=r.filter(e=>"fulfilled"===e.status).length,i=r.filter(e=>"rejected"===e.status).map(e=>"rejected"===e.status?e.reason:null).filter(Boolean),n=Date.now()-o;return i.length>0?(0,c.cM)(c.in.WARN,`통합 크롤러 완료: ${t}/${r.length} 성공, ${n}ms 소요`,{failures:i}):(0,c.cM)(c.in.INFO,`통합 크롤러 완료: ${t}/${r.length} 성공, ${n}ms 소요`),a.NextResponse.json({success:!0,message:"크롤링이 완료되었습니다.",data:{timestamp:new Date().toISOString(),duration:`${n}ms`,results:{total:r.length,successful:t,failed:i.length,errors:i}}})}catch(r){let e=r instanceof Error?r.message:"알 수 없는 오류";return(0,c.cM)(c.in.ERROR,"통합 크롤러 실행 중 오류 발생",{error:e}),a.NextResponse.json({success:!1,error:"크롤러 실행 중 오류가 발생했습니다.",details:e,timestamp:new Date().toISOString()},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cron/crawler/route",pathname:"/api/cron/crawler",filename:"route",bundlePath:"app/api/cron/crawler/route"},resolvedPagePath:"/Users/s/Desktop/dev/mobi.gg/src/app/api/cron/crawler/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:h}=l,g="/api/cron/crawler/route";function f(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}},30626:(e,r,t)=>{"use strict";t.d(r,{in:()=>s,n8:()=>g,S3:()=>m,cM:()=>d,rg:()=>f,WR:()=>x});var s,o=t(7160),i=t(29712);let n=process.env.NEXT_PUBLIC_API_BASE_URL||"/api",a=i.Z.create({baseURL:n,timeout:1e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>e,e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>Promise.reject({success:!1,data:null,error:e?.response?.data?.error||e.message||"Unknown error"})),function(e){e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(s||(s={}));let c=Number(process.env.CRAWLER_TIMEOUT_MS||"30000"),u=Number(process.env.CRAWLER_MAX_RETRIES||"3"),l=process.env.CRAWLER_LOG_LEVEL||"info",p=process.env.CRAWLER_SLACK_WEBHOOK;function d(e,r,t){let s={debug:0,info:1,warn:2,error:3};if(s[e]<s[l])return;let o=new Date().toISOString(),i=`[${o}] [${e.toUpperCase()}] ${r}`;switch(e){case"debug":console.debug(i,t||"");break;case"info":console.info(i,t||"");break;case"warn":console.warn(i,t||"");break;case"error":console.error(i,t||""),p&&"error"===e&&h(r,t).catch(e=>console.error("Failed to send Slack alert:",e))}}async function h(e,r){if(p)try{await a.post(p,{text:`🚨 *크롤러 오류 알림*
*메시지*: ${e}
*상세*: ${JSON.stringify(r)}`})}catch(e){console.error("Failed to send Slack alert:",e)}}async function g(e,r,t=u){try{d("debug",`Fetching HTML from ${e}`);let t=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1 Safari/605.1.15"],s=t[Math.floor(Math.random()*t.length)],o=await a.get(e,{timeout:c,headers:{"User-Agent":s,Accept:"text/html,application/xhtml+xml,application/xml","Accept-Language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7",...r?.headers},...r});if(200!==o.status)throw Error(`Unexpected status code: ${o.status}`);if(!o.data||"string"==typeof o.data&&0===o.data.trim().length)throw Error("Empty response data");return d("debug",`Successfully fetched HTML from ${e}`),{success:!0,data:o.data}}catch(s){if(t>0){let o=1e3*Math.pow(2,u-t)+1e3*Math.random();return d("warn",`Error fetching ${e}, retrying in ${Math.round(o)}ms (${t} retries left)`,{status:s.response?.status,message:s.message}),await new Promise(e=>setTimeout(e,o)),g(e,r,t-1)}return d("error",`Failed to fetch ${e} after ${u} retries`,{status:s.response?.status,message:s.message}),{success:!1,data:"",error:s.message}}}function f(e){try{return(0,o.zD)(e)}catch(e){throw d("error","Failed to parse HTML",e),Error(`Failed to parse HTML: ${e instanceof Error?e.message:String(e)}`)}}function m(e,r,t=!0){let s=e instanceof Error?e:Error(String(e)),o={context:r,timestamp:new Date().toISOString(),...s.stack?{stack:s.stack.split("\n").slice(0,5)}:{},...s.cause?{cause:String(s.cause)}:{}};d("error",`${r}: ${s.message}`,o);try{process.env.CRAWLER_SLACK_WEBHOOK&&s.message.includes("critical")&&h(`Critical error in ${r}`,o).catch(e=>console.error("Failed to send Slack alert:",e))}catch(e){console.error("Failed to send alert:",e)}if(t)throw s;return s}function x(e,r,t,s={}){let{minArrayLength:o=0,customValidator:i}=s;return null==e?(d("error",`${t}: 데이터가 비어 있습니다.`,{data:e}),!1):Array.isArray(e)&&"array"===r?0===e.length?(d("warn",`${t}: 빈 배열이 반환됨`,{data:e}),!1):o>0&&e.length<o?(d("warn",`${t}: 배열 길이가 너무 짧습니다. 필요: ${o}, 실제: ${e.length}`,{data:e}),!1):!i||!!i(e)||(d("error",`${t}: 사용자 정의 유효성 검사 실패`,{data:e}),!1):typeof e!==r?(d("error",`${t}: 유효하지 않은 데이터 타입, 필요: ${r}, 실제: ${typeof e}`,{data:e}),!1):!i||!!i(e)||(d("error",`${t}: 사용자 정의 유효성 검사 실패`,{data:e}),!1)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,609],()=>t(52488));module.exports=s})();